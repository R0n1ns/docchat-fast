# Система управления защищенными документами

API-система для безопасного управления документами с шифрованием и проверкой целостности.

## Особенности

- Аутентификация пользователей с двухфакторной проверкой
- Управление пользователями с различными ролями (пользователь, менеджер, администратор)
- Загрузка, скачивание и управление документами
- Шифрование документов на стороне сервера (AES-256-GCM)
- Контроль версий документов с проверкой целостности
- API-документация с использованием Swagger UI

## Технический стек

- **Язык**: Python 3.11
- **Фреймворк**: Flask
- **ORM**: SQLAlchemy
- **База данных**: PostgreSQL
- **Документация API**: Swagger UI
- **Контейнеризация**: Docker + Docker Compose

## Структура проекта

```
project/
├── api/                  # API эндпоинты
│   └── v1/               # Версия API v1
│       ├── auth.py       # Эндпоинты аутентификации
│       ├── documents.py  # Эндпоинты для работы с документами
│       └── users.py      # Эндпоинты для управления пользователями
├── uploads/              # Директория для хранения загруженных файлов
├── .dockerignore         # Исключения для Docker
├── docker-compose.yml    # Конфигурация Docker Compose
├── Dockerfile            # Инструкции для сборки Docker-образа
├── entrypoint.sh         # Скрипт запуска для Docker
├── init_db.py            # Скрипт инициализации базы данных
├── main.py               # Основной файл приложения
├── models.py             # Модели данных
├── run.sh                # Скрипт для управления приложением
├── swagger.json          # Спецификация Swagger API
└── utils.py              # Вспомогательные функции
```

## Запуск приложения

### С использованием Docker (рекомендуется)

1. Убедитесь, что у вас установлены Docker и Docker Compose.
2. Клонируйте репозиторий:
   ```
   git clone <repository-url>
   cd <repository-directory>
   ```
3. Запустите приложение с помощью скрипта:
   ```
   ./run.sh start
   ```
4. Приложение будет доступно по адресам:
   - API: http://localhost:5000
   - Swagger UI: http://localhost:5000/swagger
   - Adminer (управление БД): http://localhost:8080

### Управление приложением

Скрипт `run.sh` предоставляет следующие команды:
- `./run.sh start` - Запуск приложения
- `./run.sh stop` - Остановка приложения
- `./run.sh restart` - Перезапуск приложения
- `./run.sh logs` - Просмотр логов
- `./run.sh status` - Проверка статуса контейнеров
- `./run.sh cleanup` - Удаление всех контейнеров и данных

## API Endpoints

### Аутентификация
- `POST /api/v1/auth/register` - Регистрация нового пользователя
- `POST /api/v1/auth/login` - Вход в систему и получение кода подтверждения
- `POST /api/v1/auth/verify` - Проверка кода подтверждения и получение токенов
- `POST /api/v1/auth/refresh` - Обновление токена доступа
- `POST /api/v1/auth/logout` - Выход из системы

### Пользователи
- `GET /api/v1/users/me` - Получение информации о текущем пользователе
- `PUT /api/v1/users/me` - Обновление информации о текущем пользователе
- `GET /api/v1/users` - Получение списка всех пользователей (для менеджеров и администраторов)
- `GET /api/v1/users/{user_id}` - Получение информации о пользователе (для менеджеров и администраторов)
- `PUT /api/v1/users/{user_id}` - Обновление пользователя (для администраторов)
- `DELETE /api/v1/users/{user_id}` - Деактивация пользователя (для администраторов)

### Документы
- `POST /api/v1/documents` - Создание нового документа
- `GET /api/v1/documents` - Получение списка документов
- `GET /api/v1/documents/{document_id}` - Получение информации о документе
- `PUT /api/v1/documents/{document_id}` - Обновление документа или добавление новой версии
- `DELETE /api/v1/documents/{document_id}` - Пометка документа как удаленного
- `GET /api/v1/documents/{document_id}/download` - Скачивание текущей версии документа
- `GET /api/v1/documents/{document_id}/versions/{version_id}` - Скачивание определенной версии документа
- `GET /api/v1/documents/{document_id}/verify` - Проверка целостности документа